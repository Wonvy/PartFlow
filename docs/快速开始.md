# 🚀 PartFlow 快速开始指南

本文档将帮助你快速搭建 PartFlow 开发环境并运行项目。

---

## 📋 前置要求

- **Node.js**: >= 18.x
- **pnpm**: >= 9.x (推荐使用 `npm install -g pnpm` 安装)
- **Git**: 用于版本控制

---

## 🛠️ 安装与启动

### 1. 克隆仓库（如果需要）

```bash
git clone <repository-url>
cd PartFlow
```

### 2. 安装依赖

```bash
pnpm install
```

这会自动安装所有 workspace 的依赖（web、desktop、mobile、packages）。

### 3. 启动开发服务器

#### 启动后端 API 服务

```bash
pnpm run dev:server
```

服务将在 http://localhost:3333 运行。

#### 启动 Web 管理端

```bash
pnpm run dev:web
```

Web 应用将在 http://localhost:5173 运行。

#### 启动桌面端（Electron）

```bash
pnpm run dev:desktop
```

#### 启动移动端（Expo）

```bash
pnpm run dev:mobile
```

然后使用 Expo Go 应用扫描二维码即可在手机上查看。

---

## 🧪 测试 API

### 创建零件

```bash
curl -X POST http://localhost:3333/api/parts \
  -H "Content-Type: application/json" \
  -d '{
    "name": "M6 螺栓",
    "specification": "长度 20mm",
    "material": "不锈钢",
    "quantity": 100,
    "tags": ["紧固件", "螺栓"]
  }'
```

### 获取所有零件

```bash
curl http://localhost:3333/api/parts
```

### 搜索零件

```bash
curl "http://localhost:3333/api/parts?search=螺栓"
```

### 创建分类

```bash
curl -X POST http://localhost:3333/api/categories \
  -H "Content-Type: application/json" \
  -d '{
    "name": "紧固件",
    "description": "螺栓、螺母、垫片等"
  }'
```

### 创建位置

```bash
curl -X POST http://localhost:3333/api/locations \
  -H "Content-Type: application/json" \
  -d '{
    "name": "工具箱 A1",
    "description": "一楼工作台左侧"
  }'
```

---

## 📦 构建生产版本

### 构建所有 packages

```bash
pnpm run build:packages
```

### 构建 Web

```bash
pnpm run build:web
```

构建产物将在 `apps/web/dist/` 目录。

### 构建桌面端

```bash
pnpm run build:desktop
```

打包后的应用将在 `apps/desktop/release/` 目录。

---

## 📁 项目结构

```
/partflow
├── apps/
│   ├── web/              # Web 管理端
│   │   ├── src/
│   │   │   ├── api/      # API 客户端
│   │   │   ├── components/ # React 组件
│   │   │   ├── App.tsx   # 主应用
│   │   │   └── main.tsx  # 入口文件
│   │   ├── index.html
│   │   └── vite.config.ts
│   │
│   ├── desktop/          # 桌面端 (Electron)
│   │   ├── src/          # React 渲染进程
│   │   └── electron/     # Electron 主进程
│   │
│   └── mobile/           # 移动端 (Expo)
│       └── app/          # 应用页面
│
├── packages/
│   ├── core/             # 核心数据模型
│   │   └── src/index.ts  # Part, Category, Location 等类型定义
│   │
│   ├── server/           # Node.js 后端
│   │   ├── src/
│   │   │   ├── routes/   # API 路由
│   │   │   └── index.ts  # 服务器入口
│   │   └── package.json
│   │
│   ├── ai/               # AI 图像识别模块
│   │   └── src/index.ts  # 识别函数
│   │
│   ├── ui/               # 通用 UI 组件
│   │   └── src/          # Button, Card, Input 等
│   │
│   └── utils/            # 工具函数
│       └── src/index.ts  # assert, formatDate, debounce 等
│
└── docs/                 # 文档
```

---

## 🔧 开发技巧

### 使用 TypeScript 路径别名

项目配置了路径映射，可以直接引用 packages：

```typescript
import { createPart, Part } from "@partflow/core";
import { formatDate } from "@partflow/utils";
import { Button } from "@partflow/ui";
```

### 热重载

所有应用都支持热重载（HMR），修改代码后会自动刷新。

### 查看日志

- **Web**: 浏览器开发者工具控制台
- **Server**: 终端输出（Fastify 自带日志）
- **Desktop**: Electron 开发者工具
- **Mobile**: Expo 终端或 Expo Go 应用内日志

---

## 🐛 常见问题

### 端口被占用

如果 5173 或 3333 端口被占用，可以修改配置：

- Web: `apps/web/vite.config.ts` 中修改 `server.port`
- Server: 设置环境变量 `PORT=3334`

### pnpm 未安装

```bash
npm install -g pnpm
```

### 依赖安装失败

清理缓存重新安装：

```bash
pnpm store prune
rm -rf node_modules
pnpm install
```

---

## 📚 下一步

- 阅读 [开发说明.md](./开发说明.md) 了解详细架构
- 查看 API 文档（待完善）
- 贡献代码或提出建议

---

**Happy Coding! 🎉**

