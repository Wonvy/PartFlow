# 手机拍照功能说明

## 问题背景

在移动设备上通过 HTTP 协议（非 HTTPS）访问网页时，浏览器出于安全考虑不允许直接使用摄像头 API（`getUserMedia`）。只有在以下情况下才允许访问摄像头：

1. **HTTPS 安全连接**
2. **localhost 或 127.0.0.1**（仅限本机）

这意味着当你通过局域网 IP（如 `http://10.0.0.3:5173/`）访问时，无法使用网页内置的摄像头功能。

## 解决方案

我们已经通过 HTML5 的 `<input type="file" capture="environment">` 来实现手机拍照功能。

### 工作原理

在 `<input>` 标签中添加 `capture="environment"` 属性后：
- 在移动设备上，点击"选择文件"会直接调用系统相机
- 用户可以选择拍照或从相册选择
- 不需要摄像头 API 权限，因为是系统级调用

```html
<input 
  type="file" 
  accept="image/*" 
  capture="environment"
/>
```

### 使用方法

#### 手机上添加零件图片：

1. **点击上传区域**：在零件表单中，点击"点击选择图片"区域
2. **选择拍照**：系统会提示选择"拍照"或"从相册选择"
3. **拍摄照片**：使用手机相机拍摄零件照片
4. **确认上传**：照片会自动上传并显示预览

#### 更换已有图片：

1. 点击图片下方的"📷 拍照/选择"按钮
2. 选择拍照或从相册选择新图片
3. 新图片会替换旧图片

## 特性对比

### 原来的相机功能（CameraCapture 组件）

❌ **限制**：
- 需要 HTTPS 或 localhost
- 通过局域网 IP 访问时无法使用
- 需要浏览器权限

✅ **优点**：
- 可以实时预览
- 可以自定义界面

### 现在的文件选择 + capture 属性

✅ **优点**：
- 适用于所有协议（HTTP/HTTPS）
- 不需要特殊权限
- 调用系统原生相机，体验流畅
- 兼容性好

❌ **限制**：
- 无法实时预览（调用系统相机后才能拍摄）
- 界面由系统决定

## 技术细节

### capture 属性说明

```html
<input type="file" capture="environment">
```

- `capture="user"`：调用前置摄像头（自拍）
- `capture="environment"`：调用后置摄像头（拍摄环境）
- 不设置 `capture`：让用户选择拍照或从相册选择

### 浏览器兼容性

| 浏览器 | 支持情况 |
|--------|----------|
| iOS Safari | ✅ 支持 |
| Android Chrome | ✅ 支持 |
| Android Firefox | ✅ 支持 |
| 微信内置浏览器 | ✅ 支持 |
| 其他移动浏览器 | ✅ 大部分支持 |

## 桌面端体验

在桌面电脑上：
- `capture` 属性会被忽略
- 仍然可以正常选择文件
- 如果有摄像头，某些浏览器会提示选择"拍照"或"选择文件"

## 推荐使用场景

### 手机端（局域网访问）

✅ **推荐使用**：文件选择 + `capture` 属性
- 点击上传区域或"📷 拍照/选择"按钮
- 系统会自动调用相机

### 桌面端（localhost 访问）

✅ **两种方式都可以**：
- 使用文件选择：从文件夹选择图片
- 使用相机按钮：打开摄像头实时拍摄（需要 CameraCapture 组件）

## 如果需要 HTTPS

如果你希望在局域网使用完整的摄像头 API 功能，需要配置 HTTPS：

### 1. 生成自签名证书

```bash
# 使用 mkcert（推荐）
mkcert -install
mkcert localhost 10.0.0.3 192.168.1.100
```

### 2. 配置 Vite 使用 HTTPS

修改 `vite.config.ts`：

```typescript
import { defineConfig } from 'vite';
import fs from 'fs';

export default defineConfig({
  server: {
    https: {
      key: fs.readFileSync('./localhost-key.pem'),
      cert: fs.readFileSync('./localhost.pem'),
    }
  }
});
```

### 3. 访问

使用 `https://10.0.0.3:5173/` 访问

⚠️ **注意**：配置 HTTPS 比较复杂，对于零件管理系统来说，使用文件选择 + `capture` 属性已经足够好用。

## 总结

当前的实现方案（文件选择 + `capture` 属性）是最适合局域网访问场景的方案：
- ✅ 无需额外配置
- ✅ 无需 HTTPS
- ✅ 手机体验良好
- ✅ 兼容性好

用户只需点击上传区域，就能使用手机相机拍照，非常方便！📱📷

