# 📚 三级分类使用说明

## 概述

PartFlow 现已支持**三级分类结构**和**图标功能**，可以更精细地组织和管理零件分类。

---

## 🎯 功能特性

### 1. 三级分类结构
- **一级分类**：顶级分类（如：五金零件）
- **二级分类**：主要分类（如：紧固类、连接与传动类）
- **三级分类**：具体分类（如：螺栓、螺母、螺钉）

### 2. 图标支持
- 每个分类可以设置一个图标（emoji 或图标名称）
- 图标显示在分类卡片和选择器中
- 提供视觉识别，提升用户体验

---

## 📋 数据结构

### Category 类型
```typescript
export type Category = {
  id: string;
  name: string;
  parentId?: string;  // 父分类 ID，用于构建层级
  icon?: string;       // 图标（emoji 或图标名称）
  description?: string;
  createdAt: string;
  updatedAt: string;
};
```

### 数据库 Schema
```sql
CREATE TABLE categories (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  parent_id TEXT,
  icon TEXT,  -- 新增字段
  created_at TEXT NOT NULL,
  updated_at TEXT NOT NULL,
  FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE CASCADE
);
```

---

## 🔧 使用方法

### 1. 重新初始化数据库

如果需要应用新的数据库结构，请先删除旧数据库：

```bash
# Windows PowerShell
rm packages/server/data/partflow.db
rm packages/server/data/partflow.db-journal

# Linux/Mac
rm packages/server/data/partflow.db*
```

### 2. 启动后端服务

后端启动时会自动创建新的数据库结构：

```bash
pnpm run dev:server
```

### 3. 导入五金零件分类数据

我们提供了一套完整的五金零件分类数据：

```bash
cd scripts
tsx import-hardware-categories.ts
```

**分类数据统计：**
- 一级分类：1 个（五金零件）
- 二级分类：6 个（紧固类、连接与传动类、支撑与结构件、机加工常用件、表面与附件类、电气与气动类）
- 三级分类：40 个（具体零件类型）
- **总计：47 个分类**

---

## 📊 分类树结构

```
🔧 五金零件
├─ 🔩 紧固类
│   ├─ 🔩 螺栓
│   ├─ ⬡ 螺母
│   ├─ 📌 螺钉
│   ├─ ⭕ 垫圈
│   ├─ 📍 螺柱
│   └─ 📏 螺纹杆
├─ ⚙️ 连接与传动类
│   ├─ 📍 销
│   ├─ 🔑 键
│   ├─ 📌 铆钉
│   ├─ ⚙️ 轴承
│   ├─ 🔲 轴承座
│   └─ 🔗 联轴器
├─ 🏗️ 支撑与结构件
│   ├─ 🔲 支架
│   ├─ 📐 角码
│   ├─ 🔗 连接片
│   ├─ 📏 铝型材配件
│   ├─ ↔️ 滑轨
│   ├─ 🚪 合页
│   └─ 🔒 锁扣
├─ 🔨 机加工常用件
│   ├─ 🔩 螺纹插套
│   ├─ 💧 油嘴
│   ├─ 🔌 管接头
│   ├─ 📏 轴
│   ├─ ⭕ 垫片
│   └─ 🌀 弹簧
├─ ✨ 表面与附件类
│   ├─ 🤚 把手
│   ├─ 🦶 脚垫
│   ├─ 🛞 脚轮
│   ├─ 🥤 脚杯
│   ├─ 🧱 塑料件
│   ├─ 🧲 磁铁
│   └─ 🧴 胶类
└─ ⚡ 电气与气动类
    ├─ 🔘 开关
    ├─ 🔌 接线端子
    ├─ 🔗 电缆固定头
    ├─ ⚙️ 气缸配件
    ├─ 🚰 节流阀
    └─ 🔋 电源件
```

---

## 🎨 图标建议

### 常用 Emoji 图标
- 🔧 工具类
- 🔩 螺栓/螺母
- ⚙️ 齿轮/机械
- 📏 测量/长条
- 🔲 方形件
- 🔗 连接件
- ⚡ 电气
- 💧 液压/油类
- 🌀 弹簧/螺旋
- 📌 固定类

### 图标使用原则
1. **一致性**：同类分类使用相似图标
2. **识别性**：图标应能直观表达分类含义
3. **简洁性**：优先使用单个 emoji
4. **兼容性**：确保图标在不同系统下显示正常

---

## 📝 API 使用示例

### 创建分类
```typescript
await api.createCategory({
  name: "螺栓",
  parentId: "parent-category-id",  // 父分类 ID
  icon: "🔩",
  description: "各种规格的螺栓"
});
```

### 获取所有分类
```typescript
const categories = await api.getCategories();
```

### 获取分类树
前端可以根据 `parentId` 构建分类树：

```typescript
function buildCategoryTree(categories: Category[]): CategoryTree[] {
  const rootCategories = categories.filter(c => !c.parentId);
  
  function buildNode(category: Category): CategoryTree {
    const children = categories
      .filter(c => c.parentId === category.id)
      .map(buildNode);
    
    return {
      ...category,
      children: children.length > 0 ? children : undefined
    };
  }
  
  return rootCategories.map(buildNode);
}
```

---

## 🔍 查询与筛选

### 按分类筛选零件
```typescript
// 获取某个分类下的所有零件
const parts = await api.getParts({
  categoryId: "category-id"
});
```

### 获取子分类
```typescript
// 前端筛选子分类
const childCategories = categories.filter(
  c => c.parentId === parentCategoryId
);
```

---

## ⚠️ 注意事项

1. **级联删除**：删除父分类会自动删除所有子分类
2. **零件关联**：删除分类时，关联的零件的 `categoryId` 会被设置为 `NULL`
3. **最大层级**：建议最多使用三级分类，避免结构过于复杂
4. **图标长度**：建议使用单个 emoji，避免多字符导致显示问题

---

## 🚀 后续优化计划

- [ ] 前端分类树组件
- [ ] 分类拖拽排序
- [ ] 分类导入/导出
- [ ] 分类使用统计
- [ ] 智能分类推荐

---

**更新日期：** 2025-10-23  
**版本：** v0.2.2

