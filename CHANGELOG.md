# PartFlow 更新日志

## [v0.2.1] - 2025-10-23

### 🎯 本次更新主题
**导航与交互优化 - 统一新建操作，简化筛选流程**

### ✨ 新功能

#### 1. 页头布局重构
- **新建按钮移至顶部标题栏右侧**
  - 48×48px 圆形按钮，显示 "+" 图标
  - 位置：PartFlow 标题右侧，固定可见
  - 悬停效果：放大 + 阴影增强
  - 动态 title 提示（新建盒子/新建零件/新建分类）

- **智能显示逻辑**
  - ✅ 盒子页面：显示按钮 → 打开新建盒子表单
  - ✅ 零件页面：显示按钮 → 打开新建零件表单
  - ✅ 分类页面：显示按钮 → 打开新建分类表单
  - ❌ 数据页面：隐藏按钮（无创建功能）

#### 2. 筛选栏优化
- **直接显示筛选选项**（无需展开下拉）
  - 搜索框缩短为固定宽度（280px）
  - 分类筛选下拉框直接显示
  - 盒子筛选下拉框直接显示
  - 筛选选项改变时自动触发搜索

- **简化功能**
  - 删除低库存筛选选项（简化界面）
  - 删除"筛选 ↑/↓"展开按钮
  - 筛选有值时显示"清除"按钮
  - 移除旧的下拉筛选面板

#### 3. 组件架构升级
- **React 组件通信机制**
  - `PartsList`、`CategoriesManager`、`LocationsManager` 使用 `forwardRef` 包裹
  - 使用 `useImperativeHandle` 暴露 `handleCreate` 方法
  - 父组件 `App.tsx` 通过 `ref` 调用子组件方法
  - 实现跨组件的统一操作接口

- **父子组件通信流程**
  ```
  App.tsx (父组件)
    ↓ useRef (partsListRef, categoriesRef, locationsRef)
    ↓ ref={xxxRef}
  子组件 (PartsList, CategoriesManager, LocationsManager)
    ↓ forwardRef((props, ref) => {...})
    ↓ useImperativeHandle(ref, () => ({ handleCreate }))
  父组件调用
    ↓ xxxRef.current.handleCreate()
  ```

### 🎨 界面优化

#### 页头区域
- **新布局**：
  ```
  ┌────────────────────────────────────────┐
  │  PartFlow    零件管理系统        [+]   │
  │  [盒子] [零件] [分类] [数据]           │
  └────────────────────────────────────────┘
  ```

#### 筛选栏区域
- **新布局**：
  ```
  ┌────────────────────────────────────────┐
  │ [搜索框🔍] [全部分类▼] [全部盒子▼] [清除] │
  └────────────────────────────────────────┘
  ```

### 🐛 问题修复
- 修复 TypeScript `rootDir` 配置错误（移除 `apps/web/tsconfig.json` 中的 `rootDir`）
- 优化组件导出方式（从 `export function` 改为 `export const ... = forwardRef`）

### 🔧 技术改进
- 使用 React `forwardRef` 和 `useImperativeHandle` 实现跨组件方法调用
- 条件渲染：`currentPage !== 'data'` 控制按钮显示
- 动态属性：根据 `currentPage` 生成不同的 `title` 属性
- 自动触发搜索：筛选选项 `onChange` 时调用 `handleSearch()`

### 📝 涉及文件
1. `apps/web/src/App.tsx` - 添加统一新建按钮和 refs 管理
2. `apps/web/src/components/PartsList.tsx` - 筛选栏重构，移除低库存筛选
3. `apps/web/src/components/CategoriesManager.tsx` - 添加 `forwardRef` 支持
4. `apps/web/src/components/LocationsManager.tsx` - 添加 `forwardRef` 支持
5. `apps/web/tsconfig.json` - 移除 `rootDir` 配置

### ✨ 用户体验提升
- ✅ **操作更统一**：所有页面都用同一个 "+" 按钮创建，更符合直觉
- ✅ **筛选更快捷**：筛选选项直接显示，无需点击展开
- ✅ **界面更简洁**：搜索框缩短，留出更多空间
- ✅ **反馈更及时**：筛选改变立即生效，无需点击"应用"
- ✅ **位置更显眼**：新建按钮在顶部固定位置，始终可见

### 🔄 对比变化

#### 之前
- ❌ 新建按钮只在零件页面显示（筛选栏右侧）
- ❌ 筛选功能需要点击"筛选 ↓"展开面板
- ❌ 搜索框占用过多宽度
- ❌ 有低库存筛选选项（使用频率低）

#### 现在
- ✅ 新建按钮在所有页面显示（页头右侧）
- ✅ 筛选选项直接显示在筛选栏
- ✅ 搜索框固定 280px 宽度
- ✅ 移除低库存筛选，界面更简洁

---

## [v0.2.0] - 2025-10-23

### 🎯 本次更新主题
**界面优化与用户体验提升**

### ✨ 新功能

#### 1. 搜索功能优化
- 搜索按钮改为简洁的 SVG 图标（放大镜）
- 图标放置在搜索框内部右侧
- 默认透明背景，Hover 时显示蓝色背景
- 修复搜索框遮挡筛选按钮的布局问题

#### 2. 创建零件表单重构（响应式设计）
- **左右布局**：图片上传区（300px）+ 表单字段（自适应宽度）
- **字段优化**：
  - 零件名称 + 规格：同一行显示
  - 库存数量 + 分类：同一行显示
  - 删除预警阈值字段
  - 材质移至高级选项（默认折叠）
- **高级选项**：包含材质和标签，默认折叠状态
- **响应式适配**：
  - ≤768px：单列布局（移动端）
  - 769-900px：双列布局，图片 250px（平板）
  - >900px：双列布局，图片 300px（桌面）

#### 3. 零件卡片交互重构
- **库存调整**：`[-]` `[输入框]` `[+]` 结构
  - 输入框可直接编辑库存数量（50px 宽）
  - 加减按钮：24×24px 正方形，每次 ±1
- **简化操作**：
  - 点击卡片直接进入编辑状态
  - 删除编辑按钮和 +10/-10 按钮
  - 保留右上角删除按钮（悬停显示）

#### 4. 盒子管理界面优化
- 盒子卡片采用左右结构：盒子编号 + 零件数量
- 盒子编号下方显示盒子名称
- 文字优化："个零件" → "零件数量"
- 编辑按钮移至右上角（图标 ✎，悬停显示）
- 减小卡片尺寸和字体大小
- **盒子编号（Box Code）**：唯一、大写、字母数字

### 🎨 界面优化

#### 模态框优化
- 禁止点击外部关闭（避免误操作）
- 优化内边距和最大高度
- 添加 `overflowY: auto` 和 `boxSizing: border-box`

#### 图片上传组件风格统一
- 移除彩色边框（蓝/绿/红 → 统一灰色）
- 移除表情符号（📁 📷 🗑️）
- 统一按钮样式：灰边 + 灰字 + 白底
- **Hover 效果**：
  - 更换图片/拍照：灰色背景
  - 删除：红色背景 + 白色文字
- 添加过渡动画：`transition: 'all 0.2s'`

#### 导航栏顺序调整
- **新顺序**：盒子 → 零件 → 分类 → 数据
- **旧顺序**：零件 → 分类 → 盒子 → 数据
- **理由**：先管理存储位置，再管理零件，更符合物理世界的操作习惯

### 🐛 问题修复
- 修复创建零件表单横向滚动条问题
- 修复搜索框布局遮挡筛选按钮问题
- 修复模态框在小屏幕上的响应式问题
- 修复盒子下拉列表显示问题

### 🔧 技术改进
- CSS 响应式：使用媒体查询（`@media`）
- 布局优化：Grid 布局 + `box-sizing: border-box`
- 事件处理：`stopPropagation()` 防止事件冒泡
- 状态管理：`useState` 控制折叠/展开状态
- 交互反馈：Hover/Focus 状态提供视觉反馈

### 📝 涉及文件
1. `apps/web/src/App.tsx`
2. `apps/web/src/components/PartsList.tsx`
3. `apps/web/src/components/PartForm.tsx`
4. `apps/web/src/components/ImageUpload.tsx`
5. `apps/web/src/components/LocationsManager.tsx`
6. `apps/web/src/components/Modal.tsx`

### 🎯 设计原则
- **极简主义**：限制颜色（黑/白/灰/红/蓝）
- **统一风格**：所有组件保持一致的视觉语言
- **响应式设计**：适配移动端/平板/桌面
- **用户体验**：减少点击层级，提高操作效率
- **防误操作**：重要操作添加确认或防护机制

### ✨ 用户体验提升
- ✅ 操作更直观：点击卡片编辑，加减号调整库存
- ✅ 界面更简洁：移除冗余按钮和装饰元素
- ✅ 布局更合理：左右结构，信息密度高
- ✅ 响应更友好：支持各种屏幕尺寸
- ✅ 风格更统一：极简设计贯穿全局

---

## [v0.1.0] - 2025-10-20

### 🎉 初始版本
- 基础零件管理功能
- 分类管理功能
- 位置（盒子）管理功能
- 数据导入导出功能
- SQLite 数据持久化
- 图片上传（拖拽、粘贴、相机）
- 极简设计系统
